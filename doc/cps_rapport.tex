\documentclass{article}
%\RequirePackage{dar}
%\RequirePackage[enseignants]{pc2r}
\usepackage{graphicx}
\usepackage[francais]{babel}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{fullpage,url}
\usepackage{wasysym}

\renewcommand*{\ttdefault}{txtt}
\begin{document}

\authors{}
\titre{CPS 2019: Liens et Spécification partielle. \\ (version du 05/04/19)}

\entete{}

\section*{Manuel d'utilisation}


\section*{Spécification formelle complète}

\subsection*{Ecran}

\begin{tabular}{rl}
\textbf{Service}: & \textrm{Screen}  \\
\textbf{Observators}: & \textbf{const}~\texttt{Height}: \textrm{[Screen]} $\rightarrow$ \textrm{int} \\
& \textbf{const}~\texttt{Width}: \textrm{[Screen]} $\rightarrow$ \textrm{int} \\
& \texttt{CellNature}: \textrm{[Screen]} $\times$ \textrm{int} $\times$ \textrm{int} $\rightarrow$ \textrm{Cell} \\
& \quad \textbf{pre } \texttt{CellNature(S,x,y)} \textbf{ requires } 0 $\leq$ \texttt{y} $<$ \texttt{Height(S)} \textbf{ and } 0 $\leq$ \texttt{x} $<$ \texttt{Width(S)}\\
\textbf{Constructors}: & \texttt{init}: \textrm{int} $\times$ \textrm{int} $\rightarrow$ \textrm{[Screen]} \\
& \quad \textbf{pre } \texttt{init(h,w)} \textbf{ requires } 0 $<$ \texttt{h} \textbf{ and } 0 $<$ \texttt{w} \\
\textbf{Operators}: & \texttt{Dig}: \textrm{[Screen]} $\times$ \textrm{int} $\times$ \textrm{int}  $\rightarrow$ \textrm{[Screen]} \\
& \quad \textbf{pre } \texttt{Dig(S,x,y)} \textbf{ requires } \texttt{CellNature(S,x,y)} $=$ \textbf{PLT} \\
& \texttt{Fill}: \textrm{[Screen]} $\times$ \textrm{int} $\times$ \textrm{int}  $\rightarrow$ \textrm{[Screen]} \\
& \quad \textbf{pre } \texttt{Dig(S,x,y)} \textbf{ requires } \texttt{CellNature(S,x,y)} $=$ \textbf{HOL} \\
       \textbf{Observations}: & \\
       \texttt{[init]}: & \texttt{Height(init(h,w))} $=$ \texttt{h} \\
       & \texttt{Width(init(h,w))} $=$ \texttt{w} \\
       & \textbf{forall} $(u,v)$ \textbf{in} \texttt{[0;Width(S)[}$\times$ \texttt{[0;Height(S)[},~ \texttt{CellNature(init(h,w),x,y)} $=$ \textbf{EMP} \\
       \texttt{[Dig]}: & \texttt{CellNature(Dig(S,x,y)),x,y} $=$ \textbf{HOL} \\
        & \textbf{forall} $(u,v)$ \textbf{in} \texttt{[0;Width(S)[} $\times$ \texttt{[0;Height(S)[}, \\ & \quad\quad\quad\quad (\texttt{x} $\neq$ \texttt{u} \textbf{or} \texttt{y} $\neq$ \texttt{v}) \textbf{implies} \texttt{CellNature(Dig(S,x,y)),u,v)} $=$ \texttt{CellNature(u,v)} \\
       \texttt{[Fill]}: & \texttt{CellNature(Fill(S,x,y),x,y)} $=$ \textbf{PLT} \\
       & \textbf{forall} $(u,v)$ \textbf{in} \texttt{[0;Width(S)[}$\times$ \texttt{[0;Height(S)[}, \\ & \quad\quad\quad\quad (\texttt{x} $\neq$ \texttt{u} \textbf{or} \texttt{y} $\neq$ \texttt{v}) \textbf{implies} \texttt{CellNature(Fill(S,x,y)),u,v)} $=$ \texttt{CellNature(u,v)} \\
\end{tabular}

\subsection*{Ecran editable}

\begin{tabular}{rl}
\textbf{Service}: & \textrm{EditableScreen} {\bf includes} \textrm{Screen}  \\
\textbf{Observators}: & \texttt{Playable}: \textrm{[EditableScreen]} $\rightarrow$ \textrm{bool} \\
\textbf{Operators}: & \texttt{SetNature}: \textrm{[EditableScreen]} $\times$ \textrm{int} $\times$ \textrm{int} $\times$ \textrm{Cell}  $\rightarrow$ \textrm{[EditableScreen]} \\
& \quad \textbf{pre } \texttt{SetNature(S,x,y,C)} \textbf{ requires } 0 $\leq$ \texttt{y} $<$ \texttt{Height(S)} \textbf{ and } 0 $\leq$ \texttt{x} $<$ \texttt{Width(S)}\\
\textbf{Observations}: \\
\texttt{[invariant]}: & \texttt{Playable(S)} \textbf{min} \\
& \quad\quad\quad\quad \textbf{forall} $(x,y)$ \textbf{in} \texttt{[0;Width(S)[}$\times$ \texttt{[0;Height(S)[}, \texttt{CellNature(S,x,y)} $\neq$ \textbf{HOL}  \\
& \quad\quad\quad\quad \textbf{and} \textbf{forall} $x$ \textbf{in} \texttt{[0;Width(S)[}, \texttt{CellNature(S,x,0)} $=$ \textbf{MTL}  \\
\texttt{[SetNature]}: & \texttt{CellNature(SetNature(S,x,y,C)),x,y} $=$ C \\
        & \textbf{forall} $(u,v)$ \textbf{in} \texttt{[0;Width(S)[}$\times$ \texttt{[0;Height(S)[}, \\ & \quad\quad\quad\quad (\texttt{x} $\neq$ \texttt{u} \textbf{or} \texttt{y} $\neq$ \texttt{v}) \textbf{implies} \texttt{CellNature(SetNature(S,x,y,C)),u,v)} $=$ \texttt{CellNature(u,v)} \\
\end{tabular}


\subsection*{Environnement}


\begin{tabular}{rl}
\textbf{Service}: & Environment \textbf{includes} Screen
\\ \textbf{Observators} : & \texttt{CellContent}:
\textrm{int} $\times$ \textrm{int} $\rightarrow$
\textrm{Set\{Character + Item\}} \\
& \quad \textbf{pre } \texttt{CellContent(E,x,y)} \textbf{ requires } 0 $\leq$ \texttt{y} $<$ \texttt{Height(S)} \textbf{ and } 0 $\leq$ \texttt{x} $<$ \texttt{Width(S)}\\
\textbf{Constructors}: & \texttt{init}: \textrm{EditableScreen} $\rightarrow$ \textrm{Environment} \\
\textbf{Observations}: \\
\texttt{[invariant]}: & \textbf{forall} $(\mathtt{x},\mathtt{y})$ \textbf{in} \texttt{[0;Width(E)[}$\times$ \texttt{[0;Height(E)[},~\\ & \quad\quad \textbf{forall} \textrm{Character} \texttt{c1}, \texttt{c2} \textbf{in} \texttt{CellContent(E,x,y)}$^2$, \texttt{c1} $=$ \texttt{c2} \\
& \textbf{forall} $(\mathtt{x},\mathtt{y})$ \textbf{in} \texttt{[0;Width(E)[}$\times$ \texttt{[0;Height(E)[},~\\ & \quad\quad \texttt{CellNature(E,x,y)} \textbf{in} \{\textbf{MTL}, \textbf{PLR}\} \textbf{implies} \texttt{CellContent(x,y)} $=$ $\emptyset$  \\
& \textbf{forall} $(\mathtt{x},\mathtt{y})$ \textbf{in} \texttt{[0;Width(E)[}$\times$ \texttt{[0;Height(E)[},~\\ & \quad\quad \textbf{exists} \textrm{Treasure} \texttt{t} \textbf{in} \texttt{CellContent(E,x,y)}  \\ & \quad\quad \textbf{implies} (\texttt{CellNature(E,x,y)} $=$ \textbf{EMP} \textbf{and} \texttt{CellNature(E,x,y-1)} \textbf{in} \{\textbf{PLT}, \textbf{MTL}\})\\
                        \texttt{[init]}: & \textbf{forall} $(\mathtt{x},\mathtt{y})$ \textbf{in} \texttt{[0;Width(E)[}$\times$ \texttt{[0;Height(E)[},~\\ & \quad\quad
                                \texttt{CellNature(init(S),x,y)} $=$ \textrm{EditableScreen}::\texttt{CellNature(S,x,y)} \\

                        
\end{tabular}


\subsection*{Personnage}

\begin{tabular}{rl}
\textbf{Service}: & \textrm{Character}  \\
\textbf{Observators}: & \textbf{const}~\texttt{Envi}: \textrm{[Character]} $\rightarrow$ \textrm{Environment}  \\
 & \texttt{Hgt}: \textrm{[Character]} $\rightarrow$ \textrm{int}  \\
 & \texttt{Wdt}: \textrm{[Character]} $\rightarrow$ \textrm{int}  \\
\textbf{Operators}: & \texttt{init}: \textrm{Screen} $\times$ \textrm{int} $\times$ \textrm{int} $\rightarrow$ \textrm{[Character]} \\
& \quad\textbf{pre} \textrm{init(S,x,y)} \textbf{requires} \textrm{Environment::CellNature(S,x,y)} $=$ \textbf{EMP} \\
& \texttt{GoLeft}: \textrm{[Character]} $\rightarrow$ \textrm{[Character]} \\
 & \texttt{GoRight}: \textrm{[Character]} $\rightarrow$ \textrm{[Character]} \\
 & \texttt{GoUp}: \textrm{[Character]} $\rightarrow$ \textrm{[Character]} \\
 & \texttt{GoDown}: \textrm{[Character]} $\rightarrow$ \textrm{[Character]} \\
\textbf{Observations}: \\
\texttt{[invariant]}: & \textrm{Environment::CellNature(Envi(C),Wdt(C),Hgt(C))} \textbf{in} \{\textbf{EMP}, \textbf{HOL}, \textbf{LAD}, \textbf{HDR}\} \\
& \textbf{exists} \textrm{Character} \texttt{x} \textbf{in} \textrm{Environment::CellContent(Envi(C),Wdt(C),Hgt(C))} \textbf{implies} \texttt{x} $=$ \texttt{C}  \\


\texttt{[GoLeft]}: 
& \textrm{Hgt(GoLeft(C))} $=$ \textrm{Hgt(C)} \\
& \textrm{Wdt(C)} $=$ 0 \textbf{implies} \textrm{Wdt(GoLeft(C))} = \textrm{Wdt(C)} \\
& \textrm{Environment::CellNature(Envi(C),Wdt(C)-1,Hgt(C))} \textbf{in} \{\textbf{MTL}, \textbf{PLT} \} \\
& \quad \textbf{implies} \textrm{Wdt(GoLeft(C))} = \textrm{Wdt(C)} \\
& \textrm{Environment::CellNature(Envi(C),Wdt(C),Hgt(C))} \textbf{not in} \{\textbf{LAD}, \textbf{HDR}\}
\\ & \quad\quad \textbf{and} \textrm{Environment::CellNature(Envi(C),Wdt(C),Hgt(C)-1)} \textbf{not in} \{\textbf{PLT}, \textbf{MTL}, \textbf{LAD} \} \\
& \quad\quad \textbf{and} \textbf{not exists} \textrm{Character} c \textbf{in} \textrm{Environment::CellContent(Envi(C),Wdt(C),Hgt(C)-1)} \\
& \quad\quad \textbf{implies} \textrm{Wdt(GoLeft(C))} = \textrm{Wdt(C)} \\
& \textbf{exists} \textrm{Character} c \textbf{in} \textrm{Environment::CellContent(Envi(C),Wdt(C)-1,Hgt(C))} \\ & \quad\quad \textbf{implies} \textrm{Wdt(GoLeft(C))} = \textrm{Wdt(C)} \\
& (\textrm{Wdt(C)} $\neq$ 0) \textbf{and} \textrm{Environment::CellNature(Envi(C),Wdt(C)-1,Hgt(C))} \textbf{not in} \{\textbf{MTL}, \textbf{PLT} \} \\
& \quad\quad \textbf{and} (\textrm{Environment::CellNature(Envi(C),Wdt(C),Hgt(C))} \textbf{in} \{\textbf{LAD}, \textbf{HDR}\} \\
& \quad\quad\quad\quad \textbf{or} \textrm{Environment::CellNature(Envi(C),Wdt(C),Hgt(C)-1)} \textbf{in} \{\textbf{PLT}, \textbf{MTL}, \textbf{LAD}\} \\
& \quad\quad\quad\quad \textbf{or} \textbf{exists} \textrm{Character} c \textbf{in} \textrm{Environment::CellContent(Envi(C),Wdt(C),Hgt(C)-1)} ) \\
& \quad\quad \textbf{and} \textbf{not} (\textbf{exists} \textrm{Character} c \textbf{in} \textrm{Environment::CellContent(Envi(C),Wdt(C)-1,Hgt(C))}) \\
& \quad\quad \textbf{implies} \textrm{Wdt(GoLeft(C))} = \textrm{Wdt(C)}-1  \\

\texttt{[GoRight]}: & \textrm{Hgt(GoRight(C))} $=$ \textrm{Hgt(C)} \\
& \textrm{Wdt(C)} $=$ \textrm{Environement::Width(Envi(C))} \textbf{implies} \textrm{Wdt(GoRight(C))} = \textrm{Wdt(C)} \\
& \textrm{Environment::CellNature(Envi(C),Wdt(C)+1,Hgt(C))} \textbf{in} \{\textbf{MTL}, \textbf{PLT} \}\\
& \quad \textbf{implies} \textrm{Wdt(GoRight(C))} = \textrm{Wdt(C)} \\
& \textrm{Environment::CellNature(Envi(C),Wdt(C),Hgt(C))} \textbf{not in} \{\textbf{LAD}, \textbf{HDR}\}
\\ & \quad\quad \textbf{and} \textrm{Environment::CellNature(Envi(C),Wdt(C),Hgt(C)-1)} \textbf{not in} \{\textbf{PLT}, \textbf{MTL}, \textbf{LAD} \} \\
& \quad\quad \textbf{and} \textbf{not exists} \textrm{Character} c \textbf{in} \textrm{Environment::CellContent(Envi(C),Wdt(C),Hgt(C)-1)} \\
& \quad\quad \textbf{implies} \textrm{Wdt(GoRight(C))} = \textrm{Wdt(C)} \\
& \textbf{exists} \textrm{Character} c \textbf{in} \textrm{Environment::CellContent(Envi(C),Wdt(C)+1,Hgt(C))} \\ & \quad\quad \textbf{implies} \textrm{Wdt(GoRight(C))} = \textrm{Wdt(C)} \\
& (\textrm{Wdt(C)} $\neq$ \textrm{Environement::Height(Envi(C))} \\
& \quad \textbf{and} \textrm{Environment::CellNature(Envi(C),Wdt(C)+1,Hgt(C))} \textbf{not in} \{\textbf{MTL}, \textbf{PLT} \} \\
& \quad\quad \textbf{and} (\textrm{Environment::CellNature(Envi(C),Wdt(C),Hgt(C))} \textbf{in} \{\textbf{LAD}, \textbf{HDR}\} \\
& \quad\quad\quad\quad \textbf{or} \textrm{Environment::CellNature(Envi(C),Wdt(C),Hgt(C)-1)} \textbf{in} \{\textbf{PLT}, \textbf{MTL}, \textbf{LAD}\} \\
& \quad\quad\quad\quad \textbf{or} \textbf{exists} \textrm{Character} c \textbf{in} \textrm{Environment::CellContent(Envi(C),Wdt(C),Hgt(C)-1)} ) \\
& \quad\quad \textbf{and} \textbf{not} (\textbf{exists} \textrm{Character} c \textbf{in} \textrm{Environment::CellContent(Envi(C),Wdt(C)+1,Hgt(C))}) \\
& \quad\quad \textbf{implies} \textrm{Wdt(GoRight(C))} = \textrm{Wdt(C)}+1 \\
\end{tabular}


\begin{tabular}{rl}
\texttt{[GoUp]}: 

& \textrm{Wdt(GoUp(C))} $=$ \textrm{Wdt(C)} \\
& \textrm{Hgt(C)} $=$ \textrm{Environment::Height(Envi(C))} \textbf{implies} \textrm{Hgt(GoUp(C))} = \textrm{Hgt(C)} \\
& \textrm{Environment::CellNature(Envi(C),Wdt(C),Hgt(C))} $\neq$ \textbf{LAD} \textbf{implies} \textrm{Hgt(GoUp(C))} = \textrm{Hgt(C)} \\
& \textrm{Environment::CellNature(Envi(C),Wdt(C),Hgt(C)+1)} $\neq$ \textbf{LAD}\\
& \quad \textbf{implies} \textrm{Hgt(GoUp(C))} = \textrm{Hgt(C)} \\
& \textbf{exists} \textrm{Character} c \textbf{in} \textrm{Environment::CellContent(Envi(C),Wdt(C),Hgt(C)+1)} \textbf{implies}\\
& \quad \textrm{Hgt(GoUp(C))} = \textrm{Hgt(C)} \\

& \textrm{Hgt(C)} $\neq$ \textrm{Environment::Height(Envi(C))} \\
& \quad \textbf{and} \textrm{Environment::CellNature(Envi(C),Wdt(C),Hgt(C)+1} = \textbf{LAD} \\
& \quad \textbf{and} \textrm{Environment::CellNature(Envi(C),Wdt(C),Hgt(C)} = \textbf{LAD} \\
& \quad \textbf{and} \textbf{not exists} \textrm{Character} c \textbf{in} \textrm{Environment::CellNature(Envi(C),Wdt(C),Hgt(C)+1} \\
& \quad \textbf{implies} \textrm{Wdt(GoUp(C))} = \textrm{Hgt(C)}+1 \\

\texttt{[GoDown]}: 

& \textrm{Wdt(GoDown(C))} $=$ \textrm{Wdt(C)} \\

& \textrm{Hgt(C)} $=$ 0 \textbf{implies} \\
& \quad\textrm{Hgt(GoDown(C))} = \textrm{Hgt(C)} \\

& \textrm{Environment::CellNature(Envi(C),Wdt(C),Hgt(C)-1)} \textrm{in} \textbf{ \{ MTL,PLT \} }  \\
& \quad\textbf{implies} \textrm{Hgt(GoDown(C))} = \textrm{Hgt(C)} \\

& \textbf{exists} \textrm{Character} c \textbf{in} \textrm{Environment::CellContent(Envi(C),Wdt(C),Hgt(C)-1)} \\
& \quad \textbf{implies} \textrm{Hgt(GoDown(C))} = \textrm{Hgt(C)} \\

& \textrm{Hgt(C)} $\neq$ 0 \\
& \quad \textbf{and} \textrm{Environment::CellNature(Envi(C),Wdt(C),Hgt(C)-1)} \textrm{in} \textbf{ \{ MTL,PLT \} } \\
& \quad \textbf{and} \textbf{not exists} \textrm{Character} c \textbf{ not in} \textrm{Environment::CellNature(Envi(C),Wdt(C),Hgt(C)-1} \\
& \quad \textbf{implies} \textrm{Wdt(GoDown(C))} = \textrm{Hgt(C)}-1 \\

\end{tabular}



\subsection*{Garde}

\begin{tabular}{rl}
\textbf{Service}: & \textrm{Guard} \textbf{includes} \textrm{Character}  \\
\textbf{Observators}: & \textbf{const} \texttt{Id}: \textrm{[Guard]} $\rightarrow$ \textrm{int}  \\
 & \texttt{Behaviour}: \textrm{[Guard]} $\rightarrow$ \textrm{Move}  \\
& \texttt{Target}: \textrm{[Guard]} $\rightarrow$ \textrm{Character}  \\
& \texttt{TimeInHole}: \textrm{[Guard]} $\rightarrow$ \textrm{int}  \\
\textbf{Operators}:
& \texttt{init}: \textrm{Screen} $\times$ \textrm{int} $\times$ \textrm{int} $\times$ \textrm{Player} $\rightarrow$ \textrm{[Guard]} \\
& \quad \textbf{pre } \texttt{init(s,x,y,p)} \textbf{ requires } \textrm{Environment::CellNature(S,x,y)} $=$ \textbf{EMP} \textbf{and} \textrm{p} $\neq$ \emptyset \\
& \texttt{ClimbLeft}: \textrm{[Guard]} $\rightarrow$ \textrm{[Guard]}\\
& \quad\quad \textbf{pre} \texttt{ClimbLeft(G)} \textbf{requires} \texttt{Environment::CellNature(Envi(G),Hgt(G),Wdt(G))} $=$ \textbf{HOL} \\
& \texttt{ClimbRight}: \textrm{[Guard]} $\rightarrow$ \textrm{[Guard]}\\
& \quad\quad \textbf{pre} \texttt{ClimbRight(G)} \textbf{requires} \texttt{Environment::CellNature(Envi(G),Hgt(G),Wdt(G))} $=$ \textbf{HOL} \\
& \texttt{Step}: \textrm{[Guard]} $\rightarrow$ \textrm{[Guard]}\\
\textbf{Observations}: & \\

\textrm{[invariant]}: 

%inv down
& \textrm{Environment::CellNature(Envi(G),Wdt(G),Hgt(G))} $=$ \textbf{LAD} \\
& \quad\quad \textbf{and} \textrm{Hgt(G)} $<$ \textrm{Character::Hgt(Target(G))} \\
& \quad\quad \textbf{and} (\textrm{Environment::CellNature(Envi(G),Wdt(G),Hgt(G)-1)} \textbf{not in} \{\textbf{PLT}, \textbf{MTL}  \} \\
& \quad\quad\quad\quad \textbf{or} \textbf{exists} \textrm{Character} c \textbf{in} \textrm{Environment::CellContent(Envi(G),Wdt(G),Hgt(G)-1)} \\
& \quad\quad\quad\quad \textbf{implies} \textrm{Environment::Hgt(Target(G)) - Hgt(G)} $<$\\
& \quad\quad\quad\quad\quad $|$\textrm{Environment::Wdt(Target(G)) - Wdt(G)})$|$)\\
& \quad\quad \textbf{implies} \textrm{Behaviour(G)} $=$ \textbf{Up} \\

%inv up
& \textrm{Environment::CellNature(Envi(G),Wdt(G),Hgt(G))} $=$ \textbf{LAD} \\
& \quad\quad \textbf{and} \textrm{Hgt(G)} $>$ \textrm{Character::Hgt(Target(G))} \\
& \quad\quad \textbf{and} (\textrm{Environment::CellNature(Envi(G),Wdt(G),Hgt(G)-1)} \textbf{not in} \{\textbf{PLT}, \textbf{MTL}  \} \\
& \quad\quad\quad\quad \textbf{or} \textbf{exists} \textrm{Character} c \textbf{in} \textrm{Environment::CellContent(Envi(G),Wdt(G),Hgt(G)-1)} \\
& \quad\quad\quad\quad \textbf{implies} \textrm{Environment::Hgt(Target(G)) - Hgt(G)} $>$\\
& \quad\quad\quad\quad\quad $|$\textrm{Environment::Wdt(Target(G)) - Wdt(G)})$|$)\\
& \quad\quad \textbf{implies} \textrm{Behaviour(G)} $=$ \textbf{Down} \\

%init
\textrm{[init]}:
& \textrm{Target(G)} = \textrm{p}\\


%Climb Left
\textrm{[ClimbLeft]}: 
& \textrm{Wdt(G)} $=$ 0 \textbf{implies} \textrm{Wdt(ClimbLeft(G))} = \textrm{Wdt(G)} \textbf{and} \textrm{Hgt(ClimbLeft(G))} $=$ \textrm{Hgt(G)} \\
& \textrm{Environment::CellNature(Envi(G),Wdt(G)-1,Hgt(G) +1)} \textbf{in} \{\textbf{MTL}, \textbf{PLT} \} \\ & \quad\quad \textbf{implies} \textrm{Wdt(ClimbLeft(G))} = \textrm{Wdt(G)} \textbf{and} \textrm{Hgt(ClimbLeft(G))} $=$ \textrm{Hgt(G)} \\
& \textbf{exists} \textrm{Character} c \textbf{in} \textrm{Environment::CellContent(Envi(G),Wdt(G)-1,Hgt(G)+1)} \\
& \quad\quad \textbf{implies} \textrm{Wdt(ClimbLeft(G))} = \textrm{Wdt(G)} \textbf{and} \textrm{Hgt(ClimbLeft(G))} $=$ \textrm{Hgt(G)} \\
& \textrm{Wdt(G)} $\neq$ 0 \textbf{and} \textrm{Environment::CellNature(Envi(G),Wdt(G)-1,Hgt(G)+1)} \textbf{not in} \{\textbf{MTL}, \textbf{PLT} \} \\
& \quad\quad \textbf{and} \textbf{not exists} \textrm{Character} c \textbf{in} \textrm{Environment::CellContent(Envi(G),Wdt(G)-1,Hgt(G)+1)} \\
& \quad\quad \textbf{implies} \textrm{Wdt(ClimbLeft(G))} = \textrm{Wdt(G)}-1 \textbf{and} \textrm{Hgt(ClimbLeft(G))} = \textrm{Hgt(C)}+1 \\

%Climb Right
\textrm{[ClimbRight]}: 
& \textrm{Wdt(G)} $=$ \textrm{Environment::Width(G)} \\
& \quad \textbf{implies} \textrm{Wdt(ClimbRight(G))} = \textrm{Wdt(G)}  \textbf{and} \textrm{Hgt(ClimbRight(G))} $=$ \textrm{Hgt(G)} \\
& \textrm{Environment::CellNature(Envi(G),Wdt(G)+1,Hgt(G) +1)} \textbf{in} \{\textbf{MTL}, \textbf{PLT} \} \\ & \quad\quad \textbf{implies} \textrm{Wdt(ClimbRight(G))} = \textrm{Wdt(G)} \textbf{and} \textrm{Hgt(ClimbRight(G))} $=$ \textrm{Hgt(G)} \\
& \textbf{exists} \textrm{Character} c \textbf{in} \textrm{Environment::CellContent(Envi(G),Wdt(G)+1,Hgt(G)+1)} \\
& \quad\quad \textbf{implies} \textrm{Wdt(ClimbRight(G))} = \textrm{Wdt(G)} \textbf{and} \textrm{Hgt(ClimbLeft(G))} $=$ \textrm{Hgt(G)} \\
& \textrm{Wdt(G)} $\neq$ \textrm{Environment::Width(G)} \textbf{and} \\
& \quad \quad\textrm{Environment::CellNature(Envi(G),Wdt(G)-1,Hgt(G)+1)} \textbf{not in} \{\textbf{MTL}, \textbf{PLT} \} \\
& \quad\quad \textbf{and} \textbf{not exists} \textrm{Character} c \textbf{in}  \textrm{Environment::CellContent(Envi(G),Wdt(G)+1,Hgt(G)+1)} \\
& \quad\quad \textbf{implies} \textrm{Wdt(ClimbRight(G))} = \textrm{Wdt(G)}+1 \textbf{and} \textrm{Hgt(ClimbLeft(G))} = \textrm{Hgt(G)}+1 \\
\end{tabular}

%step
\begin{tabular}{rl}
\textrm{[Step]}:
& \textbf{WillFall}\texttt{(G)} \textbf{defined by} (\textrm{Environment::CellNature(Envi(G),Wdt(G),Hgt(G)-1)} \textbf{in} \{\textbf{HOL}, \textbf{EMP} \}  \\
& \quad\quad \textbf{and} \textbf{not exists} \textrm{Character} c \textbf{in} \textrm{Environment::CellContent(Envi(G),Wdt(G),Hgt(G)-1)} \\
& \quad\quad \textbf{and} \textrm{Environment::CellNature(Envi(G),Wdt(G),Hgt(G))} \textbf{not in} \{\textbf{LAD}, \textbf{HDR} \} ) \\

& \textbf{WillIncTime}\texttt{(G)} \textbf{defined by} 
(\textrm{Environment::CellNature(Envi(G),Wdt(G),Hgt(G))} = \textrm{HOL} \textbf{and} \\
& \quad\quad \textrm{TimeInHole(G) $<$ 5)}
\\

& \textbf{WillLeft}\texttt{(G)} \textbf{defined by} 
(\textrm{Environment::CellNature(Envi(G),Wdt(G),Hgt(G))} = \textrm{HOL} \textbf{and} \\
& \quad\quad \textrm{TimeInHole(G)  $=$ 5} \textbf{and} \textrm{Behavior(G) = Left}) \\

& \textbf{WillRight}\texttt{(G)} \textbf{defined by} 
(\textrm{Environment::CellNature(Envi(G),Wdt(G),Hgt(G))} = \textrm{HOL} \textbf{and} \\
& \quad\quad \textrm{TimeInHole(G)  $=$ 5} \textbf{and} \textrm{Behavior(G)  = Right}) \\

& \textbf{WillNeutral}\texttt{(G)} \textbf{defined by} 
(\textrm{Environment::CellNature(Envi(G),Wdt(G),Hgt(G))} = \textrm{HOL} \textbf{and} \\
& \quad\quad \textrm{TimeInHole $=$ 5} \textbf{and} \textrm{Behavior = Neutral}) \\

& \textbf{WillGoLeft}\texttt{(G)} \textbf{defined by}  \textrm{Behavior(G)  = Left}\\

& \textbf{WillGoRight}\texttt{(G)} \textbf{defined by}  \textrm{Behavior(G)  = Right} \\

& \textbf{WillGoUp}\texttt{(G)} \textbf{defined by}  \textrm{Behavior(G)  = Up} \\

& \textbf{WillGoDown}\texttt{(G)} \textbf{defined by}  \textrm{Behavior(G)  = Down} \\

&\textbf{WillFall}\texttt{(G)} \textbf{implies} \textbf{GoDown}\texttt{(G)} \\

 &\textbf{WillTimeInc}\texttt{(G)} \textbf{implies} \textrm{TimeInHole(Step(G))} = \textrm{TimeInHole(G) +1}\\
 
& \textbf{WillLeft}\texttt{(G)}  \textbf{implies} \textrm{ClimbLeft} \texttt{(G)}\\ 

& \textbf{WillRight}\texttt{(G)}  \textbf{implies} \textrm{ClimbRight} \texttt{(G)}\\ 

& \textbf{WillNeutral}\texttt{(G)}  \textbf{implies} \textrm{Hgt(Step(G)) = Hgt(G)} \textbf{and} \textrm{Wdt(Step(G)) = Wdt(G)}\\ 

& \textbf{WillGoLeft}\texttt{(G)}  \textbf{implies} \textrm{GoLeft} \texttt{(G)}\\ 

& \textbf{WillGoRight}\texttt{(G)}  \textbf{implies} \textrm{GoRight} \texttt{(G)}\\ 

& \textbf{WillGoUp}\texttt{(G)}  \textbf{implies} \textrm{GoUp} \texttt{(G)}\\ 
& \textbf{WillGoDown}\texttt{(G)}  \textbf{implies} \textrm{GoDown} \texttt{(G)}\\ 

\end{tabular}

\newpage

\subsection*{Joueur}

\begin{tabular}{rl}
\textbf{Service}: & \textrm{Player} \textbf{includes} \textrm{Character} \\
\textbf{Observators}: & \texttt{Engine}: \textrm{[Player]} $\rightarrow$ \textrm{Engine}  \\
\textbf{Operators}:
& \texttt{init}: \textrm{Screen} $\times$ \textrm{int} $\times$ \textrm{int} $\times$ \textrm{Engine} $\rightarrow$ \textrm{[Player]} \\
& \quad \textbf{pre } \texttt{init(S,x,y,e)} \textbf{ requires } \textrm{Environment::CellNature(S,x,y)} $=$ \textbf{EMP} \textbf{and} \textrm{e} $\neq$ \emptyset \\

& \texttt{Step}: \textrm{[Player]} $\rightarrow$ \textrm{[Player]}\\
\textbf{Observations}: & \\

%step
%init
\textrm{[init]}:
& \textbf{Engine(P)} = \textrm{e}\\

\textrm{[Step]}:
& \textbf{WillFall}\texttt{(P)} \textbf{defined by} (\textrm{Environment::CellNature(Envi(P),Wdt(P),Hgt(P)-1)} \\
& \quad\quad \textbf{in} \{\textbf{HOL}, \textbf{EMP} \}  \\
& \quad\quad \textbf{and} \textbf{not exists} \textrm{Character} c \textbf{in} \textrm{Environment::CellContent(Envi(G),Wdt(P),Hgt(P)-1)} \\
& \quad\quad \textbf{and} \textrm{Environment::CellNature(Envi(P),Wdt(P),Hgt(P))} \textbf{not in} \{\textbf{LAD}, \textbf{HDR} \} ) \\

& \textbf{WillGoLeft}\texttt{(P)} \textbf{defined by}  \textrm{Engine::NextCommand(Engine(P))  = Left}\\

& \textbf{WillGoRight}\texttt{(P)} \textbf{defined by}   \textrm{Engine::NextCommand(Engine(P))  = Right}\\

& \textbf{WillGoUp}\texttt{(P)} \textbf{defined by}   \textrm{Engine::NextCommand(Engine(P))  = Up}\\

& \textbf{WillGoDown}\texttt{(P)} \textbf{defined by}  \textrm{Engine::NextCommand(Engine(P))  = Down}\\

&\textbf{WillDigL}\texttt{(P)} \textbf{defined by}  \textrm{Engine::NextCommand(Engine(P))  = DigL}\\
%case non libre
& \quad \textbf{and} ( \textrm{Environment::CellNature(Envi(P),Wdt(P),Hgt(P)-1)} \textbf{in} \{\textbf{PLT}, \textbf{MTL}, \textbf{LAD}\} \\
& \quad\quad\quad\quad \textbf{or} \textbf{exists} \textrm{Character} c \textbf{in} \textrm{Environment::CellContent(Envi(P),Wdt(P),Hgt(P)-1)} ) \\
& \quad \textbf{and} \textrm{Environment::CellNature(Envi(P),Wdt(P)-1,Hgt(P))} \textbf{not in} \{\textbf{PLT}, \textbf{MTL}\} \\
& \quad \textbf{and} \textrm{Environment::CellNature(Envi(P),Wdt(P)-1,Hgt(P)-1)} = \textrm{PLT} \\

&\textbf{WillDigR}\texttt{(P)} \textbf{defined by}  \textrm{Engine::NextCommand(Engine(P))  = DigR}\\
%case non libre
& \quad \textbf{and} ( \textrm{Environment::CellNature(Envi(P),Wdt(P),Hgt(P)-1)} \textbf{in} \{\textbf{PLT}, \textbf{MTL}, \textbf{LAD}\} \\
& \quad\quad\quad\quad \textbf{or} \textbf{exists} \textrm{Character} c \textbf{in} \textrm{Environment::CellContent(Envi(P),Wdt(P),Hgt(P)-1)} ) \\
& \quad \textbf{and} \textrm{Environment::CellNature(Envi(P),Wdt(P)+1,Hgt(P))} \textbf{not in} \{\textbf{PLT}, \textbf{MTL}\} \\
& \quad \textbf{and} \textrm{Environment::CellNature(Envi(P),Wdt(P)+1,Hgt(P)+1)} = \textrm{PLT} \\

%post
& \textbf{WillGoLeft}\texttt{(P)}  \textbf{implies} \textrm{GoLeft} \texttt{(P)}\\ 

& \textbf{WillGoRight}\texttt{(P)}  \textbf{implies} \textrm{GoRight} \texttt{(P)}\\ 

& \textbf{WillGoUp}\texttt{(P)}  \textbf{implies} \textrm{GoUp} \texttt{(P)}\\ 

& \textbf{WillGoDown}\texttt{(P)}  \textbf{implies} \textrm{GoDown} \texttt{(P)}\\

& \textbf{WillDigL}\texttt{(P)} \textbf{implies}
\textrm{Environment::Dig(Envi(P),Wdt(P)-1,Hgt(P)-1)}\\
& \quad \textbf{and} \textrm{Environment::CellNature(Envi(P),Wdt(P)-1,Hgt(P)-1)} = \textrm{HOL} \\

& \textbf{WillDigR}\texttt{(P)} \textbf{implies} \textrm{Environment::Dig(Envi(P),Wdt(P)+1,Hgt(P)+1)}\\

& \quad \textbf{and} \textrm{Environment::CellNature(Envi(P),Wdt(P)+1,Hgt(P)+1)} = \textrm{HOL} \\

\end{tabular}


\subsection*{Engine}

\begin{tabular}{rl}
\textbf{Service}: & \textrm{Engine} \\
\textbf{Observators}: & \texttt{Environment}: \textrm{[Engine]} $\rightarrow$ \textrm{Environment}  \\
  & \texttt{Player}: \textrm{[Engine]} $\rightarrow$  \textrm{Player}   \\
 & \texttt{Guards}: \textrm{[Engine]} $\rightarrow$ \textrm{Set \{Guard\}}  \\
  & \texttt{Treasure}: \textrm{[Engine]} $\rightarrow$  \textrm{Set \{Treasure\}}   \\
   & \texttt{Status}: \textrm{[Engine]} $\rightarrow$ \textrm{Status}  \\
   &  \texttt{NextCommand}: \textrm{[Engine]} $\rightarrow$ \textrm{NextCommand}  \\
      &  \texttt{Holes}: \textrm{[Engine]} $\rightarrow$ \textrm{Triplet \{int $\times$ int $\times$ int \}}  \\
      
\textbf{Operators}:
& \texttt{init}: \textrm{EditableScreen} $\times$ \textrm{int} $\times$ \textrm{int} $\times$ \textrm{Pair \{int  $\times$ int \}} $\times$ \textrm{Pair\{int  $\times$ int \}} $\rightarrow$ \textrm{[Player]} \\
& \quad \textbf{pre } \texttt{init(S,x,y,G,T)} \textbf{ requires } \textrm{Environment::CellNature(S,x,y)} $=$ \textbf{EMP} \\

& \texttt{Step}: \textrm{[Engine]} $\rightarrow$ \textrm{[Engine]}\\
\textbf{Observations}: & \\

%step
%init
\textrm{[init]}:
& \textbf{Engine(P)} = \textrm{e}\\

\textrm{[Step]}:
& \textbf{WillFall}\texttt{(P)} \textbf{defined by} (\textrm{Environment::CellNature(Envi(P),Wdt(P),Hgt(P)-1)} \\
& \quad\quad \textbf{in} \{\textbf{HOL}, \textbf{EMP} \}  \\
& \quad\quad \textbf{and} \textbf{not exists} \textrm{Character} c \textbf{in} \textrm{Environment::CellContent(Envi(G),Wdt(P),Hgt(P)-1)} \\
& \quad\quad \textbf{and} \textrm{Environment::CellNature(Envi(P),Wdt(P),Hgt(P))} \textbf{not in} \{\textbf{LAD}, \textbf{HDR} \} ) \\

& \textbf{WillGoLeft}\texttt{(P)} \textbf{defined by}  \textrm{Engine::NextCommand(Engine(P))  = Left}\\

& \textbf{WillGoRight}\texttt{(P)} \textbf{defined by}   \textrm{Engine::NextCommand(Engine(P))  = Right}\\

& \textbf{WillGoUp}\texttt{(P)} \textbf{defined by}   \textrm{Engine::NextCommand(Engine(P))  = Up}\\

& \textbf{WillGoDown}\texttt{(P)} \textbf{defined by}  \textrm{Engine::NextCommand(Engine(P))  = Down}\\

&\textbf{WillDigL}\texttt{(P)} \textbf{defined by}  \textrm{Engine::NextCommand(Engine(P))  = DigL}\\
%case non libre
& \quad \textbf{and} ( \textrm{Environment::CellNature(Envi(P),Wdt(P),Hgt(P)-1)} \textbf{in} \{\textbf{PLT}, \textbf{MTL}, \textbf{LAD}\} \\
& \quad\quad\quad\quad \textbf{or} \textbf{exists} \textrm{Character} c \textbf{in} \textrm{Environment::CellContent(Envi(P),Wdt(P),Hgt(P)-1)} ) \\
& \quad \textbf{and} \textrm{Environment::CellNature(Envi(P),Wdt(P)-1,Hgt(P))} \textbf{not in} \{\textbf{PLT}, \textbf{MTL}\} \\
& \quad \textbf{and} \textrm{Environment::CellNature(Envi(P),Wdt(P)-1,Hgt(P)-1)} = \textrm{PLT} \\

&\textbf{WillDigR}\texttt{(P)} \textbf{defined by}  \textrm{Engine::NextCommand(Engine(P))  = DigR}\\
%case non libre
& \quad \textbf{and} ( \textrm{Environment::CellNature(Envi(P),Wdt(P),Hgt(P)-1)} \textbf{in} \{\textbf{PLT}, \textbf{MTL}, \textbf{LAD}\} \\
& \quad\quad\quad\quad \textbf{or} \textbf{exists} \textrm{Character} c \textbf{in} \textrm{Environment::CellContent(Envi(P),Wdt(P),Hgt(P)-1)} ) \\
& \quad \textbf{and} \textrm{Environment::CellNature(Envi(P),Wdt(P)+1,Hgt(P))} \textbf{not in} \{\textbf{PLT}, \textbf{MTL}\} \\
& \quad \textbf{and} \textrm{Environment::CellNature(Envi(P),Wdt(P)+1,Hgt(P)+1)} = \textrm{PLT} \\

%post
& \textbf{WillGoLeft}\texttt{(P)}  \textbf{implies} \textrm{GoLeft} \texttt{(P)}\\ 

& \textbf{WillGoRight}\texttt{(P)}  \textbf{implies} \textrm{GoRight} \texttt{(P)}\\ 

& \textbf{WillGoUp}\texttt{(P)}  \textbf{implies} \textrm{GoUp} \texttt{(P)}\\ 

& \textbf{WillGoDown}\texttt{(P)}  \textbf{implies} \textrm{GoDown} \texttt{(P)}\\

& \textbf{WillDigL}\texttt{(P)} \textbf{implies}
\textrm{Environment::Dig(Envi(P),Wdt(P)-1,Hgt(P)-1)}\\
& \quad \textbf{and} \textrm{Environment::CellNature(Envi(P),Wdt(P)-1,Hgt(P)-1)} = \textrm{HOL} \\

& \textbf{WillDigR}\texttt{(P)} \textbf{implies} \textrm{Environment::Dig(Envi(P),Wdt(P)+1,Hgt(P)+1)}\\

& \quad \textbf{and} \textrm{Environment::CellNature(Envi(P),Wdt(P)+1,Hgt(P)+1)} = \textrm{HOL} \\

\end{tabular}



\section*{Description formelle des tests MBT effectués}

\section*{rapport de projet}

\end{document}


